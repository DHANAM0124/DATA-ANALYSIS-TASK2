 1. Top Customers by Quantity 
WITH CustomerOrderTotals AS (
  SELECT 
    c.CustomerID,
    c.Name,
    SUM(o.Quantity) AS TotalQuantity
  FROM Customers c
  JOIN Orders o ON c.CustomerID = o.CustomerID
  GROUP BY c.CustomerID, c.Name
)
SELECT *,
       RANK() OVER (ORDER BY TotalQuantity DESC) AS QuantityRank
FROM CustomerOrderTotals;

2. Detect Orphan Orders
SELECT *
FROM Orders
WHERE CustomerID NOT IN (
  SELECT CustomerID FROM Customers
);

3. Order Frequency Per Customer 
SELECT 
  o.OrderID,
  c.Name,
  o.Product,
  o.Quantity,
  ROW_NUMBER() OVER (PARTITION BY o.CustomerID ORDER BY o.OrderID) AS OrderSequence
FROM Orders o
JOIN Customers c ON o.CustomerID = c.CustomerID;

4.Product Demand Ranking 
WITH ProductDemand AS (
  SELECT 
    Product,
    SUM(Quantity) AS TotalOrdered
  FROM Orders
  GROUP BY Product
)
SELECT *,
       DENSE_RANK() OVER (ORDER BY TotalOrdered DESC) AS DemandRank
FROM ProductDemand;
